Module : Az.Resources
Cmdlet : New-AzResourceGroupDeployment
Parameters
 -ResourceGroupName : Ayanfe-Resource
 -TemplateFile : multiple-RSVaults.json
 -DeploymentDebugLogLevel : All

[Common.Authentication]: Authenticating using Account: 'oluwafemi.aina@tek-experts.com', environment: 'AzureCloud', tenant: 'ffcea58c-766b-4eea-9684-92cc7cb3c5e9'
7:03:24 AM - [SilentAuthenticator] Calling SharedTokenCacheCredential.GetTokenAsync - TenantId:'ffcea58c-766b-4eea-9684-92cc7cb3c5e9', Scopes:'https://management.core.windows.net//.default', AuthorityHost:'https://login.microsoftonline.com/', UserId:'oluwafemi.aina@tek-experts.com'
SharedTokenCacheCredential.GetToken invoked. Scopes: [ https://management.core.windows.net//.default ] ParentRequestId: 
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:24 - ] Azure region was not configured or could not be discovered. Not using a regional authority.
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:24] Found 1 cache accounts and 0 broker accounts
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:24] Returning 1 accounts
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:24 - ] MSAL MSAL.Desktop with assembly version '4.30.1.0'. CorrelationId(ff7eaed5-9b91-43f1-95f8-b47f3e9642f3)
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:24 - ] === AcquireTokenSilent Parameters ===
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:24 - ] LoginHint provided: False
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:24 - ] Account provided: True
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:24 - ] ForceRefresh: False
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:24 - ] 
=== Request Data ===
Authority Provided? - True
Scopes - https://management.core.windows.net//.default
Extra Query Params Keys (space separated) - 
ApiId - AcquireTokenSilent
IsConfidentialClient - False
SendX5C - False
LoginHint ? False
IsBrokerConfigured - False
HomeAccountId - False
CorrelationId - ff7eaed5-9b91-43f1-95f8-b47f3e9642f3

(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:24 - ] === Token Acquisition (SilentRequest) started:
	
	Authority Host: login.microsoftonline.com
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:24 - ] Azure region was not configured or could not be discovered. Not using a regional authority.
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:24 - ] Access token has expired or about to expire. [Current time (11/26/2021 07:03:24) - Expiration Time (11/25/2021 16:11:29 +00:00) - Extended Expiration Time (11/25/2021 16:11:29 +00:00)]
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:24 - ] Azure region was not configured or could not be discovered. Not using a regional authority.
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:24 - ] Azure region was not configured or could not be discovered. Not using a regional authority.
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:24 - ] Refresh token found in the cache? - True
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:24 - ] Azure region was not configured or could not be discovered. Not using a regional authority.
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:24 - ] Fetching instance discovery from the network from host login.microsoftonline.com. 
Request [f03ad944-dd81-4b20-8976-0efa527fddeb] GET https://login.microsoftonline.com/common/discovery/instance?api-version=REDACTED&authorization_endpoint=REDACTED
x-client-SKU:REDACTED
x-client-Ver:REDACTED
x-client-CPU:REDACTED
x-client-OS:REDACTED
client-request-id:REDACTED
return-client-request-id:REDACTED
x-app-name:REDACTED
x-app-ver:REDACTED
x-ms-client-request-id:f03ad944-dd81-4b20-8976-0efa527fddeb
x-ms-return-client-request-id:true
User-Agent:azsdk-net-Identity/1.5.0,(.NET Framework 4.8.4420.0; Microsoft Windows 10.0.19042 )
client assembly: Azure.Identity
Response [f03ad944-dd81-4b20-8976-0efa527fddeb] 200 OK (00.1s)
Strict-Transport-Security:REDACTED
X-Content-Type-Options:REDACTED
Access-Control-Allow-Origin:REDACTED
Access-Control-Allow-Methods:REDACTED
client-request-id:REDACTED
x-ms-request-id:edc98684-00f9-4f43-beed-a3f9380f4501
x-ms-ests-server:REDACTED
Cache-Control:max-age=86400, private
P3P:REDACTED
Set-Cookie:REDACTED
Date:Fri, 26 Nov 2021 07:03:24 GMT
Content-Length:980
Content-Type:application/json; charset=utf-8

(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:25 - ] Authority validation enabled? True. 
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:25 - ] Authority validation - is known env? True. 
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:25 - ] Resolving authority endpoints... Already resolved? - FALSE
Request [e85623ef-b9ac-4c2a-9412-951434ab4e94] POST https://login.microsoftonline.com/ffcea58c-766b-4eea-9684-92cc7cb3c5e9/oauth2/v2.0/token
x-client-SKU:REDACTED
x-client-Ver:REDACTED
x-client-CPU:REDACTED
x-client-OS:REDACTED
x-client-current-telemetry:REDACTED
x-client-last-telemetry:REDACTED
x-ms-lib-capability:REDACTED
client-request-id:REDACTED
return-client-request-id:REDACTED
x-app-name:REDACTED
x-app-ver:REDACTED
x-ms-client-request-id:e85623ef-b9ac-4c2a-9412-951434ab4e94
x-ms-return-client-request-id:true
User-Agent:azsdk-net-Identity/1.5.0,(.NET Framework 4.8.4420.0; Microsoft Windows 10.0.19042 )
Content-Type:application/x-www-form-urlencoded
client assembly: Azure.Identity
Response [e85623ef-b9ac-4c2a-9412-951434ab4e94] 200 OK (00.2s)
Pragma:no-cache
Strict-Transport-Security:REDACTED
X-Content-Type-Options:REDACTED
client-request-id:REDACTED
x-ms-request-id:a3522d11-ab71-4f34-97eb-16dfbc1d8500
x-ms-ests-server:REDACTED
x-ms-clitelem:REDACTED
Cache-Control:no-store, no-cache
P3P:REDACTED
Set-Cookie:REDACTED
Date:Fri, 26 Nov 2021 07:03:24 GMT
Content-Length:4921
Content-Type:application/json; charset=utf-8
Expires:-1

(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:25 - ] Checking client info returned from the server..
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:25 - ] Saving Token Response to cache..
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:25 - ] Subject not present in Id token
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:25 - ] Azure region was not configured or could not be discovered. Not using a regional authority.
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:25 - ] Saving AT in cache and removing overlapping ATs...
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:25 - ] Looking for scopes for the authority in the cache which intersect with https://management.core.windows.net//.default
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:25 - ] Intersecting scope entries count - 1
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:25 - ] Matching entries after filtering by user - 1
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:25 - ] Saving Id Token and Account in cache ...
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:25 - ] Saving RT in cache...
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:25] Not writing FRT in ADAL legacy cache. 
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:25 - ] Fetched access token from host login.microsoftonline.com. 
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/26/2021 07:03:25 - ] === Token Acquisition finished successfully. An access token was returned with Expiration Time: 11/26/2021 08:19:54 +00:00 and Scopes https://management.core.windows.net//user_impersonation https://management.core.windows.net//.default
SharedTokenCacheCredential.GetToken succeeded. Scopes: [ https://management.core.windows.net//.default ] ParentRequestId:  ExpiresOn: 2021-11-26T08:19:54.0000000+00:00
[Common.Authentication]: Received token with LoginType 'User', Tenant: 'ffcea58c-766b-4eea-9684-92cc7cb3c5e9', UserId: 'oluwafemi.aina@tek-experts.com'
============================ HTTP REQUEST ============================

HTTP Method:
POST

Absolute Uri:
https://management.azure.com/subscriptions/eb682f6e-1934-4ce4-a41e-c78eea352117/resourcegroups/Ayanfe-Resource/providers/Microsoft.Resources/deployments/multiple-RSVaults/validate?api-version=2021-04-01

Headers:
x-ms-client-request-id        : c98491e8-30d7-4f84-a95a-5b9dbca51716
accept-language               : en-US

Body:
{
  "properties": {
    "template": {
      "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
      "contentVersion": "1.0.0.0",
      "parameters": {
        "RSVaultCount": {
          "type": "int",
          "defaultValue": 2
        }
      },
      "variables": {
        "RSVaultName": "[concat(copyIndex(), 'RSValut', uniqueString(resourceGroup().id))]"
      },
      "resources": [
        {
          "name": "[variables('RSVaultName')]",
          "type": "Microsoft.RecoveryServices/vaults",
          "apiVersion": "2021-03-01",
          "location": "[resourceGroup().location]",
          "sku": {
            "name": "RS0",
            "tier": "Standard"
          },
          "properties": {},
          "Copy": {
            "name": "RSVaultcopy",
            "count": "[parameters('RSVaultCount')]"
          }
        }
      ],
      "outputs": {}
    },
    "parameters": {},
    "mode": "Incremental",
    "debugSetting": {
      "detailLevel": "RequestContent,ResponseContent"
    }
  }
}


============================ HTTP RESPONSE ============================

Status Code:
BadRequest

Headers:
Pragma                        : no-cache
x-ms-failure-cause            : gateway
x-ms-ratelimit-remaining-subscription-writes: 1199
x-ms-request-id               : b1e639bf-ec0a-4a0a-a29d-a08ccb371de9
x-ms-correlation-request-id   : b1e639bf-ec0a-4a0a-a29d-a08ccb371de9
x-ms-routing-request-id       : EASTUS:20211126T070326Z:b1e639bf-ec0a-4a0a-a29d-a08ccb371de9
Strict-Transport-Security     : max-age=31536000; includeSubDomains
X-Content-Type-Options        : nosniff
Cache-Control                 : no-cache
Date                          : Fri, 26 Nov 2021 07:03:26 GMT

Body:
{
  "error": {
    "code": "InvalidTemplate",
    "message": "Deployment template validation failed: 'The template variable 'RSVaultName' is not valid: The template function 'copyIndex' is not expected at this location. The function can only be used in a resource with copy specified. Please see https://aka.ms/arm-copy for usage details.. Please see https://aka.ms/arm-template-expressions for usage details.'.",
    "additionalInfo": [
      {
        "type": "TemplateViolation",
        "info": {
          "lineNumber": 13,
          "linePosition": 91,
          "path": "properties.template.variables.RSVaultName"
        }
      }
    ]
  }
}


