Module : Az.Resources
Cmdlet : New-AzResourceGroupDeployment
Parameters
 -Name : new-linux
 -ResourceGroupName : Ayanfe-Resource
 -TemplateFile : azuredeploy.json

[Common.Authentication]: Authenticating using Account: 'oluwafemi.aina@tek-experts.com', environment: 'AzureCloud', tenant: 'ffcea58c-766b-4eea-9684-92cc7cb3c5e9'
3:12:38 PM - [SilentAuthenticator] Calling SharedTokenCacheCredential.GetTokenAsync - TenantId:'ffcea58c-766b-4eea-9684-92cc7cb3c5e9', Scopes:'https://management.core.windows.net//.default', AuthorityHost:'https://login.microsoftonline.com/', UserId:'oluwafemi.aina@tek-experts.com'
SharedTokenCacheCredential.GetToken invoked. Scopes: [ https://management.core.windows.net//.default ] ParentRequestId: 
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/23/2021 15:12:38 - ] Azure region was not configured or could not be discovered. Not using a regional authority.
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/23/2021 15:12:38] Found 1 cache accounts and 0 broker accounts
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/23/2021 15:12:38] Returning 1 accounts
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/23/2021 15:12:38 - ] MSAL MSAL.Desktop with assembly version '4.30.1.0'. CorrelationId(a8d69cd7-8802-488f-ae3a-f3b5e2b07572)
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/23/2021 15:12:38 - ] === AcquireTokenSilent Parameters ===
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/23/2021 15:12:38 - ] LoginHint provided: False
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/23/2021 15:12:38 - ] Account provided: True
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/23/2021 15:12:38 - ] ForceRefresh: False
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/23/2021 15:12:38 - ] 
=== Request Data ===
Authority Provided? - True
Scopes - https://management.core.windows.net//.default
Extra Query Params Keys (space separated) - 
ApiId - AcquireTokenSilent
IsConfidentialClient - False
SendX5C - False
LoginHint ? False
IsBrokerConfigured - False
HomeAccountId - False
CorrelationId - a8d69cd7-8802-488f-ae3a-f3b5e2b07572

(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/23/2021 15:12:38 - ] === Token Acquisition (SilentRequest) started:
	
	Authority Host: login.microsoftonline.com
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/23/2021 15:12:38 - ] Azure region was not configured or could not be discovered. Not using a regional authority.
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/23/2021 15:12:38 - ] Access token is not expired. Returning the found cache entry. [Current time (11/23/2021 15:12:38) - Expiration Time (11/23/2021 16:17:19 +00:00) - Extended Expiration Time (11/23/2021 16:17:19 +00:00)]
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/23/2021 15:12:38 - ] Returning access token found in cache. RefreshOn exists ? False
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/23/2021 15:12:38 - ] Fetched access token from host login.microsoftonline.com. 
(False) MSAL 4.30.1.0 MSAL.Desktop Windows 10 Pro [11/23/2021 15:12:38 - ] === Token Acquisition finished successfully. An access token was returned with Expiration Time: 11/23/2021 16:17:19 +00:00 and Scopes https://management.core.windows.net//user_impersonation https://management.core.windows.net//.default
SharedTokenCacheCredential.GetToken succeeded. Scopes: [ https://management.core.windows.net//.default ] ParentRequestId:  ExpiresOn: 2021-11-23T16:17:19.0000000+00:00
[Common.Authentication]: Received token with LoginType 'User', Tenant: 'ffcea58c-766b-4eea-9684-92cc7cb3c5e9', UserId: 'oluwafemi.aina@tek-experts.com'
============================ HTTP REQUEST ============================

HTTP Method:
POST

Absolute Uri:
https://management.azure.com/subscriptions/eb682f6e-1934-4ce4-a41e-c78eea352117/resourcegroups/Ayanfe-Resource/providers/Microsoft.Resources/deployments/new-linux/validate?api-version=2021-04-01

Headers:
x-ms-client-request-id        : 1b31b0a7-a1d1-4d36-8bf8-798405b0ee8f
accept-language               : en-US

Body:
{
  "properties": {
    "template": {
      "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
      "contentVersion": "1.0.0.0",
      "parameters": {},
      "functions": [],
      "variables": {},
      "resources": [
        {
          "name": "[toLower('ubuntuVM1storage')]",
          "type": "Microsoft.Storage/storageAccounts",
          "apiVersion": "2021-04-01",
          "location": "[resourceGroup().location]",
          "tags": {
            "displayName": "ubuntuVM1 Storage Account"
          },
          "sku": {
            "name": "Standard_LRS"
          },
          "kind": "Storage"
        },
        {
          "name": "ubuntuVM1-PublicIP",
          "type": "Microsoft.Network/publicIPAddresses",
          "apiVersion": "2020-11-01",
          "location": "[resourceGroup().location]",
          "tags": {
            "displayName": "PublicIPAddress"
          },
          "properties": {
            "publicIPAllocationMethod": "Dynamic",
            "dnsSettings": {
              "domainNameLabel": "[toLower('ubuntuVM1')]"
            }
          }
        },
        {
          "name": "ubuntuVM1-nsg",
          "type": "Microsoft.Network/networkSecurityGroups",
          "apiVersion": "2020-11-01",
          "location": "[resourceGroup().location]",
          "properties": {
            "securityRules": [
              {
                "name": "nsgRule1",
                "properties": {
                  "description": "description",
                  "protocol": "Tcp",
                  "sourcePortRange": "*",
                  "destinationPortRange": "22",
                  "sourceAddressPrefix": "*",
                  "destinationAddressPrefix": "*",
                  "access": "Allow",
                  "priority": 100,
                  "direction": "Inbound"
                }
              }
            ]
          }
        },
        {
          "name": "ubuntuVM1-VirtualNetwork",
          "type": "Microsoft.Network/virtualNetworks",
          "apiVersion": "2020-11-01",
          "location": "[resourceGroup().location]",
          "dependsOn": [
            "[resourceId('Microsoft.Network/networkSecurityGroups', 'ubuntuVM1-nsg')]"
          ],
          "tags": {
            "displayName": "ubuntuVM1-VirtualNetwork"
          },
          "properties": {
            "addressSpace": {
              "addressPrefixes": [
                "10.0.0.0/16"
              ]
            },
            "subnets": [
              {
                "name": "ubuntuVM1-VirtualNetwork-Subnet",
                "properties": {
                  "addressPrefix": "10.0.0.0/24",
                  "networkSecurityGroup": {
                    "id": "[resourceId('Microsoft.Network/networkSecurityGroups', 'ubuntuVM1-nsg')]"
                  }
                }
              }
            ]
          }
        },
        {
          "name": "ubuntuVM1-NetworkInterface",
          "type": "Microsoft.Network/networkInterfaces",
          "apiVersion": "2020-11-01",
          "location": "[resourceGroup().location]",
          "dependsOn": [
            "[resourceId('Microsoft.Network/publicIPAddresses', 'ubuntuVM1-PublicIP')]",
            "[resourceId('Microsoft.Network/virtualNetworks', 'ubuntuVM1-VirtualNetwork')]"
          ],
          "tags": {
            "displayName": "ubuntuVM1-NetworkInterface"
          },
          "properties": {
            "ipConfigurations": [
              {
                "name": "ipConfig1",
                "properties": {
                  "privateIPAllocationMethod": "Dynamic",
                  "publicIPAddress": {
                    "id": "[resourceId('Microsoft.Network/publicIPAddresses', 'ubuntuVM1-PublicIP')]"
                  },
                  "subnet": {
                    "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', 'ubuntuVM1-VirtualNetwork', 'ubuntuVM1-VirtualNetwork-Subnet')]"
                  }
                }
              }
            ]
          }
        },
        {
          "name": "ubuntuVM1",
          "type": "Microsoft.Compute/virtualMachines",
          "apiVersion": "2021-03-01",
          "location": "[resourceGroup().location]",
          "dependsOn": [
            "[resourceId('Microsoft.Network/networkInterfaces', 'ubuntuVM1-NetworkInterface')]"
          ],
          "tags": {
            "displayName": "ubuntuVM1"
          },
          "properties": {
            "hardwareProfile": {
              "vmSize": "Standard_A2_v2"
            },
            "osProfile": {
              "computerName": "ubuntuVM1",
              "adminUsername": "adminUsername",
              "adminPassword": "adminPassword"
            },
            "storageProfile": {
              "imageReference": {
                "publisher": "Canonical",
                "offer": "UbuntuServer",
                "sku": "16.04-LTS",
                "version": "latest"
              },
              "osDisk": {
                "name": "ubuntuVM1-OSDisk",
                "caching": "ReadWrite",
                "createOption": "FromImage"
              }
            },
            "networkProfile": {
              "networkInterfaces": [
                {
                  "id": "[resourceId('Microsoft.Network/networkInterfaces', 'ubuntuVM1-NetworkInterface')]"
                }
              ]
            },
            "diagnosticsProfile": {
              "bootDiagnostics": {
                "enabled": true,
                "storageUri": "[reference(resourceId('Microsoft.Storage/storageAccounts/', toLower('ubuntuVM1storage'))).primaryEndpoints.blob]"
              }
            }
          }
        }
      ],
      "outputs": {}
    },
    "parameters": {},
    "mode": "Incremental"
  }
}


============================ HTTP RESPONSE ============================

Status Code:
BadRequest

Headers:
Pragma                        : no-cache
x-ms-failure-cause            : gateway
x-ms-ratelimit-remaining-subscription-writes: 1199
x-ms-request-id               : dee4b15b-a5a9-44b7-83ee-643e84abb953
x-ms-correlation-request-id   : dee4b15b-a5a9-44b7-83ee-643e84abb953
x-ms-routing-request-id       : EASTUS:20211123T151240Z:dee4b15b-a5a9-44b7-83ee-643e84abb953
Strict-Transport-Security     : max-age=31536000; includeSubDomains
X-Content-Type-Options        : nosniff
Cache-Control                 : no-cache
Date                          : Tue, 23 Nov 2021 15:12:40 GMT

Body:
{
  "error": {
    "code": "InvalidTemplateDeployment",
    "message": "The template deployment 'new-linux' is not valid according to the validation procedure. The tracking id is 'dee4b15b-a5a9-44b7-83ee-643e84abb953'. See inner errors for details.",
    "details": [
      {
        "code": "PreflightValidationCheckFailed",
        "message": "Preflight validation failed. Please refer to the details for the specific errors.",
        "details": [
          {
            "code": "StorageAccountAlreadyTaken",
            "target": "ubuntuvm1storage",
            "message": "The storage account named ubuntuvm1storage is already taken."
          }
        ]
      }
    ]
  }
}


